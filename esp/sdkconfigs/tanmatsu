# Tanmatsu (ESP32-P4 with badge-bsp) configuration
# Matching trackmatsu sdkconfig for PSRAM compatibility
CONFIG_IDF_TARGET="esp32p4"

# Select Tanmatsu as the BSP target
CONFIG_BSP_TARGET_TANMATSU=y

# Flash configuration
CONFIG_ESPTOOLPY_FLASHMODE_QIO=y
CONFIG_ESPTOOLPY_FLASHFREQ_80M=y
CONFIG_ESPTOOLPY_FLASHSIZE_16MB=y

# PSRAM configuration - match trackmatsu exactly
CONFIG_SPIRAM=y
CONFIG_SPIRAM_SPEED_200M=y
CONFIG_SPIRAM_MALLOC_RESERVE_INTERNAL=65536
CONFIG_SPIRAM_MALLOC_ALWAYSINTERNAL=256
CONFIG_SPIRAM_ALLOW_BSS_SEG_EXTERNAL_MEMORY=y

# Experimental features needed for ESP32-P4
CONFIG_IDF_EXPERIMENTAL_FEATURES=y

# Disable PSRAM memory protection pre-configuration
# (This may be causing the address mismatch between heap and tracking)
CONFIG_SPIRAM_PRE_CONFIGURE_MEMORY_PROTECTION=n

# USB console
CONFIG_ESP_CONSOLE_USB_SERIAL_JTAG=y

# Power management
CONFIG_PM_ENABLE=y
CONFIG_PM_DFS_INIT_AUTO=y

# FAT filesystem
CONFIG_FATFS_VOLUME_COUNT=3

# Flash support
CONFIG_SPI_FLASH_SUPPORT_WINBOND_CHIP=y

# =============================================================================
# PERFORMANCE OPTIMIZATIONS FOR ESP32-P4
# =============================================================================

# L2 Cache: Increase from 128KB to 256KB for better cache hit rate
# Trade-off: reduces available RAM but significantly improves code execution speed
# NOTE: If 256KB works well, can try 512KB for even better performance
CONFIG_CACHE_L2_CACHE_256KB=y

# Disable hardware stack guard for slight performance improvement
# (especially with frequent interrupts like PIT timer)
CONFIG_ESP_SYSTEM_HW_STACK_GUARD=n

# Disable assertions in release builds for performance
CONFIG_COMPILER_OPTIMIZATION_ASSERTIONS_DISABLE=y

# Log level ERROR for performance
CONFIG_LOG_DEFAULT_LEVEL_ERROR=y

# Disable dynamic log level control (~10x faster logging)
CONFIG_LOG_DYNAMIC_LEVEL_CONTROL=n

# Optimize misaligned memory access (small IRAM cost for better performance)
CONFIG_LIBC_OPTIMIZED_MISALIGNED_ACCESS=y
