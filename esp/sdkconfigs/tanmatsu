# Tanmatsu (ESP32-P4 with badge-bsp) configuration
# Matching trackmatsu sdkconfig for PSRAM compatibility
CONFIG_IDF_TARGET="esp32p4"

# Select Tanmatsu as the BSP target
CONFIG_BSP_TARGET_TANMATSU=y

# Flash configuration
CONFIG_ESPTOOLPY_FLASHMODE_QIO=y
CONFIG_ESPTOOLPY_FLASHFREQ_80M=y
CONFIG_ESPTOOLPY_FLASHSIZE_16MB=y

# PSRAM configuration - match trackmatsu exactly
CONFIG_SPIRAM=y
CONFIG_SPIRAM_SPEED_200M=y
CONFIG_SPIRAM_MALLOC_RESERVE_INTERNAL=65536
CONFIG_SPIRAM_MALLOC_ALWAYSINTERNAL=256
CONFIG_SPIRAM_ALLOW_BSS_SEG_EXTERNAL_MEMORY=y

# Experimental features needed for ESP32-P4
CONFIG_IDF_EXPERIMENTAL_FEATURES=y

# Disable PSRAM memory protection pre-configuration
# (This may be causing the address mismatch between heap and tracking)
CONFIG_SPIRAM_PRE_CONFIGURE_MEMORY_PROTECTION=n

# USB console
CONFIG_ESP_CONSOLE_USB_SERIAL_JTAG=y

# Power management
CONFIG_PM_ENABLE=y
CONFIG_PM_DFS_INIT_AUTO=y

# FAT filesystem (LFN required for exFAT support)
CONFIG_FATFS_VOLUME_COUNT=3
CONFIG_FATFS_LFN_HEAP=y
CONFIG_FATFS_EXFAT=y

# Flash support
CONFIG_SPI_FLASH_SUPPORT_WINBOND_CHIP=y

# =============================================================================
# PERFORMANCE OPTIMIZATIONS FOR ESP32-P4
# =============================================================================

# L2 Cache: 256KB (up from default 128KB) for better cache hit rate
# 512KB tested but caused IPS variance (1.0-1.8M vs stable 1.62M) due to SRAM pressure
CONFIG_CACHE_L2_CACHE_256KB=y

# Disable hardware stack guard for slight performance improvement
# (especially with frequent interrupts like PIT timer)
CONFIG_ESP_SYSTEM_HW_STACK_GUARD=n

# Disable assertions in release builds for performance
CONFIG_COMPILER_OPTIMIZATION_ASSERTIONS_DISABLE=y

# Log level ERROR for performance
CONFIG_LOG_DEFAULT_LEVEL_ERROR=y

# Disable dynamic log level control (~10x faster logging)
CONFIG_LOG_DYNAMIC_LEVEL_CONTROL=n

# Optimize misaligned memory access (small IRAM cost for better performance)
CONFIG_LIBC_OPTIMIZED_MISALIGNED_ACCESS=y

# =============================================================================
# ESP-HOSTED WiFi SDIO (slot 1 â†’ ESP32-C6 radio)
# Pin assignments must match Tanmatsu hardware
# =============================================================================
CONFIG_ESP_HOSTED_PRIV_SDIO_PIN_CMD_SLOT_1=16
CONFIG_ESP_HOSTED_PRIV_SDIO_PIN_CLK_SLOT_1=17
CONFIG_ESP_HOSTED_PRIV_SDIO_PIN_D0_SLOT_1=18
CONFIG_ESP_HOSTED_PRIV_SDIO_PIN_D1_4BIT_BUS_SLOT_1=19
CONFIG_ESP_HOSTED_PRIV_SDIO_PIN_D2_4BIT_BUS_SLOT_1=20
CONFIG_ESP_HOSTED_PRIV_SDIO_PIN_D3_4BIT_BUS_SLOT_1=21
CONFIG_ESP_HOSTED_SDIO_RESET_SLAVE_USING_CALLBACK=y
CONFIG_ESP_HOSTED_SLAVE_RESET_ON_EVERY_HOST_BOOTUP=y
CONFIG_ESP_HOSTED_HOST_RESTART_NO_COMMUNICATION_WITH_SLAVE=n
